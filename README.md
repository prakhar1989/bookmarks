# Stashly

A personal bookmarking application with AI-powered content extraction, summarization, and tagging. Save links, automatically extract page content, and get intelligent summaries and tags generated by Google Gemini 2.0.

## Features

- **Smart Bookmarking**: Save any URL with an optional personal note
- **Automatic Content Extraction**: Uses Mozilla Readability to extract clean article content
- **AI-Powered Summaries**: Google Gemini 2.0 generates concise and detailed summaries
- **Intelligent Tagging**: Automatically categorizes bookmarks with relevant tags
- **Full-Text Search**: Search bookmarks by title, URL, content, or tags
- **Tag Filtering**: Browse bookmarks by specific tags
- **User Authentication**: Powered by Stack Auth (formerly Neon Auth)
- **Database**: Neon Postgres with Drizzle ORM
- **UI**: Tailwind CSS + shadcn/ui components

## Prerequisites

- [Neon](https://neon.com) account
- [Stack Auth](https://stack-auth.com) account (or use Neon Auth)
- [Google AI Studio](https://aistudio.google.com/apikey) API key for Gemini
- Node.js 18+ installed locally

## Local Development Setup

### 1. Set up Stack Auth

1. Create or open a [Neon project](https://console.neon.tech/app/projects)
2. Go to **Neon Auth** → **Setup instructions**
3. Click **Set up Auth** to generate your configuration
4. Copy these environment variables to `.env.local`:
   - `NEXT_PUBLIC_STACK_PROJECT_ID`
   - `NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY`
   - `STACK_SECRET_SERVER_KEY`
   - `DATABASE_URL`

### 2. Set up Google AI API

1. Get your API key from [Google AI Studio](https://aistudio.google.com/apikey)
2. Add to `.env.local`:
   - `GOOGLE_API_KEY`

### 3. Install dependencies and run migrations

```bash
# Install all dependencies
npm install

# Generate database migrations
npm run drizzle:generate

# Apply migrations to your database
npm run drizzle:migrate
```

### 4. Start the development server

```bash
npm run dev
```

Visit `http://localhost:3000` to see the application running. Sign in and start adding bookmarks!

## How It Works

### Bookmark Processing Pipeline

1. **User submits a URL** with optional note and tags
2. **URL normalization** - Removes tracking parameters, www prefix, etc.
3. **Content fetching** - Downloads HTML with timeout and size limits
4. **Content extraction** - Mozilla Readability extracts clean article text
5. **AI Analysis** - Google Gemini 2.0 generates:
   - Title (if not available)
   - Short summary (1-2 sentences)
   - Detailed summary
   - Language detection
   - Relevant tags
6. **Database storage** - Saves all data with full-text search indexing
7. **Status update** - Marks as `processed` or `failed`

### Database Schema

- **users** - User accounts
- **bookmarks** - Core bookmark data (URL, title, description, status)
- **bookmark_contents** - Extracted content and AI summaries
- **tags** - User-specific tags (normalized)
- **bookmark_tags** - Many-to-many relationship

### API Routes

- `POST /api/bookmarks` - Create new bookmark
- `GET /api/bookmarks` - List with search/filter
- `GET /api/bookmarks/[id]` - Get single bookmark
- `POST /api/bookmarks/[id]/reprocess` - Retry failed processing
- `GET /api/tags` - Get all tags with counts

## Usage

### Adding Bookmarks

1. Enter any URL in the form
2. Optionally add a personal note
3. Optionally add comma-separated tags
4. Click "Add Bookmark"
5. AI automatically analyzes and tags the content

### Searching

- Use the search bar for full-text search
- Click tag chips to filter by specific tags
- Combine search query with tag filters

### Viewing Details

- Click any bookmark card to see full details
- View short and detailed summaries
- See all metadata (language, source type, processing date)
- Retry processing for failed bookmarks

## Project Structure

```
app/
├── api/
│   ├── bookmarks/
│   │   ├── [id]/
│   │   │   ├── route.ts           # GET single bookmark
│   │   │   └── reprocess/
│   │   │       └── route.ts       # POST retry processing
│   │   └── route.ts               # POST create, GET list bookmarks
│   └── tags/
│       └── route.ts               # GET all tags with counts
├── b/
│   └── [id]/
│       └── page.tsx               # Bookmark detail page
├── handler/
│   └── [...stack]/
│       └── page.tsx               # Stack Auth handler
├── schema/
│   └── schema.ts                  # Drizzle ORM schema (all tables)
├── bookmarks-list.tsx             # Main bookmarks list component
├── bookmarks-page.tsx             # Bookmarks page wrapper
├── add-bookmark.tsx               # Add bookmark form component
├── db.tsx                         # Database helper with auth
├── header.tsx                     # App header component
├── layout.tsx                     # Root layout
├── page.tsx                       # Home page
└── stack.tsx                      # Stack Auth configuration

components/
├── bookmarks/
│   ├── bookmark-card.tsx          # Bookmark card UI component
│   ├── favicon.tsx                # Favicon display component
│   └── search-filter.tsx          # Search and tag filter UI
└── ui/
    ├── button.tsx                 # shadcn/ui button
    ├── card.tsx                   # shadcn/ui card
    └── input.tsx                  # shadcn/ui input

lib/
├── bookmark-utils.ts              # URL normalization, tag management
├── bookmark-processor.ts          # Main bookmark processing pipeline
├── content-extractor.ts           # HTML fetching & readability parsing
├── llm-client.ts                  # Google Gemini AI integration
└── utils.ts                       # General utilities (cn helper)

drizzle/
├── 0000_lean_dragon_man.sql       # Initial migration
├── 0001_dry_caretaker.sql         # Bookmarks schema migration
├── 0002_add_gin_index.sql         # Full-text search index
└── meta/                          # Drizzle metadata
    ├── _journal.json
    ├── 0000_snapshot.json
    └── 0001_snapshot.json
```

## Production Setup

Configure production settings in the Neon Console's Auth Configuration tab, such as domain restrictions.

## Learn More

- [Design Documentation](docs/design.md) - Full technical design
- [Neon Auth Documentation](https://neon.com/docs/guides/neon-auth)
- [Stack Auth Documentation](https://docs.stack-auth.com/)
- [Google AI Studio](https://aistudio.google.com/)
- [Gemini API Documentation](https://ai.google.dev/gemini-api/docs)

## Future Enhancements

- Background job processing for content extraction
- Browser extension for quick bookmarking
- Collections/folders for organization
- Bookmark sharing and collaboration
- Export to various formats (JSON, HTML, Markdown)
- Semantic search with pgvector
- Dark mode support
